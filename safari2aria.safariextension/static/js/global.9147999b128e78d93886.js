webpackJsonp([4],{160:function(e,t,n){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=O.language||navigator.language;return k()(M,[n,e],t.notfailback?"":[e," "].join(""))}function a(){var e={};O.rpcList.forEach(function(t,n){var o=t.url.match(/^(http|ws)(s)?(?:\:\/\/)(token\:[^@]*)?@?([^\:\/]*)\:?(\d*)(\/[^\/]*)/),a={host:o[4],port:o[5]||6800,secure:!(!o||!o[2]),secret:o[3]?o[3].split(":")[1]:"",path:o[6]||"/jsonrpc"};if(E[t.url])e[t.url]=E[t.url],e[t.url].rpc.name=t.name,delete E[t.url];else{var r=new C.Aria2(a);e[t.url]={aria2:r,rpc:t,push:t.push}}t.push&&i(e[t.url],t.name)});for(var t in E){var n=E[t].aria2;n&&n.socket&&1===n.socket.readyState&&E[t].aria2.close()}E=e}function i(e,t){var n=e.aria2;return!(!e.aria2||!e.aria2.socket||1!==n.socket.readyState)||(n.open().then(function(){s(e,t),e.reconnect&&(delete e.reconnect,N.success([o("Successful links to"),t]))}).catch(function(n){k()(safari,"application.activeBrowserWindow.activeTab.url")&&(!e.reconnect&&N.error([o("Make sure the aria2 is running, every 10 seconds will automatically retry")],[t,o("Connection fail")]),e.reconnect=!0),T=T||setInterval(function(){var e=0;S()(E,function(t){t.push&&(e+=i(t)?0:1)}),e||clearInterval(T)},1e4)}),!1)}function r(){k()(safari,"extension.popovers[0].contentWindow.tlwin.refreshTaskList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshTaskList()}function s(e,t){var n=e.aria2,a=function(e){},i=function(e){r()},s=function(e,t){r(),c(n,e.gid).then(function(e){N.show(t?"error":"success",[e,o("Download"),o(t?"error":"success")])})};n.onDownloadStart=a,n.onDownloadPause=i,n.onDownloadStop=i,n.onDownloadComplete=s,n.onBtDownloadComplete=s,n.onDownloadError=function(e){s(e,!0)}}function c(e,t){return e.tellStatus(t,["bittorrent"]).then(function(n){return e.getFiles(t).then(function(e){return{files:e,bt:n}})}).then(function(e){var t=e.files[0].path,n=t.split("/").pop();return e.bt&&e.bt.info?bt.bittorrent.info.name:n}).catch(function(e){N.error([o("Failed to get task information")])})}function l(e){var t={},n=E[e[0].url],a=!!n&&n.aria2,i=O.enableCookie?"Cookie: "+e[3]:"";O.baiduPanCookie&&(i=[i,O.baiduPanCookie].join("; ")),O.downloadPath&&(t.dir=O.downloadPath),a&&e[1]?a.addUri([e[1]],D({header:i,timeout:10,"content-disposition-default-utf8":!0,"user-agent":O.userAgent},t)).then(function(){N.success([o("Successfully added to the"),n.rpc.name,O.enableCookie?"":"(with cookie)"]),r()}).catch(function(e){N.error([o("Fail to Added to the"),n.rpc.name,O.enableCookie?"":"(without cookie)","("+e.message+")"]),console.log(e)}):N.error(["添加任务失败：没有url或者没有连接aria2"])}function u(e){"showOptions"===e.key&&f()}function f(){safari.application.activeBrowserWindow.openTab().url=safari.extension.baseURI+"options.html"}function d(){O=localStorage.getItem("safari2aria");try{O=O?JSON.parse(O):I.a}catch(e){O={defaultRpcIndex:0}}P=O.filetypes?O.filetypes.split(" "):[];for(var e=0;e<P.length;e++)P[e]=P[e].toLowerCase();W=O.rpcList,p("updateConfig",D({},O,{sendAll:!0})),a(),k()(safari,"extension.popovers[0].contentWindow.tlwin.refreshServerList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshServerList()}function p(e,t,n){t instanceof Function&&(n=t,t={}),n&&(t=Object.assign(t||{},{hasCb:!0}),B[e+"_cb"]=n),window.safari&&(t.sendAll?k()(safari,"application.browserWindows",[]).forEach(function(n){k()(n,"tabs",[]).forEach(function(n){n.page&&n.page.dispatchMessage(e,t)})}):safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(e,t))}function h(e){if(j=e.keyPressed||{},j.isShiftPressd&&j.isOptionPressd){for(var t=49;t<=57&&t-49<W.length;t++)if(j[t]){O.defaultRpcIndex=t-49,y({name:"updateSafari2Aria",message:O}),p("changeRpc",W[O.defaultRpcIndex].name);break}j[192]&&p("currentRpc",W[O.defaultRpcIndex].name),j[188]&&f(),j[76]&&safari&&safari.extension&&safari.extension.toolbarItems[0].showPopover()}}function m(e){var t=e.command.split("."),n={showOptions:function(){f()},DownloadWithXunleilixian:function(){safari.application.activeBrowserWindow.openTab().url=["http://lixian.vip.xunlei.com/?furl=",e.userInfo[0]].join("")},DownloadWithBaidulixian:function(){safari.application.activeBrowserWindow.openTab().url="https://pan.baidu.com/disk/home",R.baiduLixian={action:function(){p("baiduLixian",this.param),delete R.baiduLixian},param:{url:e.userInfo[0]}}},DownloadWithAria2:function(){var n=t[1];l([n&&W[n]?W[n]:W[0]].concat(e.userInfo))}};n[t[0]]&&n[t[0]]()}function v(e){var t=e.command&&e.command.match(/^DownloadWith/);if(t&&t.length>=0){var n=e.userInfo;n&&n.length&&n[0]||(e.target.disabled=!0)}}function g(e){n.i(L.a)(e.url,O,j)&&(e.preventDefault(),p("getCookie",function(t){l([W[O.defaultRpcIndex],e.url,e.target.url,t.cookie])}))}function w(e){W.forEach(function(t,n){e.contextMenu.appendContextMenuItem(["DownloadWithAria2",n].join("."),[o("Downloaded to"),t.name].join(""))}),O.enableXunleiLixian&&e.contextMenu.appendContextMenuItem("DownloadWithXunleilixian",[o("Import to thunder lixian")].join("")),O.enableBaiduLixian&&e.contextMenu.appendContextMenuItem("DownloadWithBaidulixian",[o("Import to baidu lixian")].join(""))}function y(e){B[e.name]&&B[e.name](e.message,e)}Object.defineProperty(t,"__esModule",{value:!0});var b=n(18),k=n.n(b),x=n(55),S=n.n(x),C=n(54),L=n(36),A=n(56),I=n.n(A),D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},O={defaultRpcIndex:0},M={"zh-CN":{"Successful links to":"成功链接","Connection fail":"连接失败",Download:"下载",error:"失败","Import to thunder lixian":"导入至迅雷离线","Import to baidu lixian":"导入至百度离线","Downloaded to":"下载至",success:"成功","Successfully added to the":"成功添加至","Fail to Added to the":"无法添加至","Added to the":"添加至",failure:"失败","Failed to get task information":"获取任务信息失败","Make sure the aria2 is running, every 10 seconds will automatically retry":"请确认aria2已经运行,每隔10秒将会自动重试"}},j=void 0,P=[],W=[],E={},R={},T=void 0,B={updateSafari2Aria:function(e){localStorage.setItem("safari2aria",JSON.stringify(e)),d()},keyPress:function(e){h(e)},getConfig:function(){p("updateConfig",D({},O,{sendAll:!0}))},documentReady:function(){S()(R,function(e){e.action()})},downloadFromIframe:function(e,t){l([W[O.defaultRpcIndex],e.url,t.target.url,e.cookie])}},N={success:function(e,t){N.show("success",e,t)},error:function(e,t){N.show("error",e,t)},show:function(e,t,n){t instanceof Array&&(t=t.join("")),n instanceof Array&&(n=n.join("")),p("showMassage",{action:e||"success",text:t,title:n})}};window.s2a={changeServer:function(e){var t=void 0;S()(W,function(n,o){n.url===e&&(t=o)}),O.defaultRpcIndex=t,y({name:"updateSafari2Aria",message:O})},dispatchMessage:y,openOptions:f,getConfig:function(){return{config:O,aria2Connects:E}}},document.addEventListener("DOMContentLoaded",d),safari.application.addEventListener("message",y,!1),safari.extension.settings.addEventListener("change",u,!1),safari.application.addEventListener("command",m,!1),safari.application.addEventListener("validate",v,!1),safari.application.addEventListener("beforeNavigate",g,!1),safari.application.addEventListener("contextmenu",w,!1)},36:function(e,t,n){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0;try{o=new URL(e)}catch(e){return!1}var a=o,i=a.pathname,r=a.protocol;if(!n[82]&&t.enableTypefiles?!n.isCommandPressed:n.isCommandPressed){if("magnet:"===r)return!0;if(n.isShiftPressd)return!0;if(!i.includes("."))return!1;var s=i.toLowerCase();return!!t.filetypes&&t.filetypes.toLowerCase().split(/\s+/).map(function(e){return"."+e}).some(function(e){return s.endsWith(e)})}return!1}t.a=o},54:function(e,t,n){"use strict";(function(e){var t=n(128),o=n.n(t),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(t){var n=void 0!==e&&e.exports,i=function e(t){this.callbacks=Object.create(null),this.lastId=0;for(var n in e.options)this[n]="object"===(void 0===t?"undefined":a(t))&&n in t?t[n]:e.options[n]};i.prototype.http=function(e,t){var n=this,o={method:e.method,id:e.id};Array.isArray(e.params)&&e.params.length>0&&(o.params=e.params);var a="http"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path;fetch(a,{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){n._onmessage(e)}).catch(t)},i.prototype.send=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"==typeof t[t.length-1]?t.pop():null;return this.exec(e,t,n)},i.prototype.exec=function(e,t,n){if("string"!=typeof e)throw new TypeError(e+" is not a string");0!==e.indexOf("system.")&&0!==e.indexOf("aria2.")&&(e="aria2."+e);var a={method:e,"json-rpc":"2.0",id:this.lastId++},i=this.secret?["token:"+this.secret]:[];Array.isArray(t)&&("system.multicall"===e?(Array.isArray(t[0])&&t[0].forEach(function(e){e.params||(e.params=[]),e.params=i.concat(e.params)}),i=t):i=i.concat(t)),i.length>0&&(a.params=i),this.onsend(a);var r=this;return this.socket&&1===this.socket.readyState?this.socket.send(JSON.stringify(a)):this.http(a,function(e){r.callbacks[a.id](e),delete r.callbacks[a.id]}),o()(function(e){r.callbacks[a.id]=e},n)},i.prototype._onmessage=function(e){if(this.onmessage(e),void 0!==e.id){var t=this.callbacks[e.id];t&&(e.error?t(e.error):t(null,e.result),delete this.callbacks[e.id])}else if(e.method){var n=e.method.split("aria2.")[1];0===n.indexOf("on")&&"function"==typeof this[n]&&i.notifications.indexOf(n)>-1&&this[n].apply(this,e.params)}},i.prototype.open=function(e){var t="ws"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path,n=this.socket=new WebSocket(t),a=this,i=!1;return n.onmessage=function(e){a._onmessage(JSON.parse(e.data))},o()(function(e){n.onopen=function(){i||(e(),i=!0),a.onopen()},n.onclose=function(t){a.onclose(),1006==t.code&&(i||(e(t),i=!0))},n.onerror=function(t){i||(e(t),i=!0)}},e)},i.prototype.close=function(e){var t=this.socket;return o()(function(e){t?(t.addEventListener("close",function(){e()}),t.close()):e()},e)},i.methods=["addUri","addTorrent","addMetalink","remove","forceRemove","pause","pauseAll","forcePause","forcePauseAll","unpause","unpauseAll","tellStatus","getUris","getFiles","getPeers","getServers","tellActive","tellWaiting","tellStopped","changePosition","changeUri","getOption","changeOption","getGlobalOption","changeGlobalOption","getGlobalStat","purgeDownloadResult","removeDownloadResult","getVersion","getSessionInfo","shutdown","forceShutdown","saveSession","system.multicall","system.listMethods","system.listNotifications"],i.notifications=["onDownloadStart","onDownloadPause","onDownloadStop","onDownloadComplete","onDownloadError","onBtDownloadComplete"],i.events=["onopen","onclose","onsend","onmessage"],i.options={secure:!1,host:"localhost",port:6800,secret:"",path:"/jsonrpc"},i.methods.forEach(function(e){var t=e.indexOf(".")>-1?e.split(".")[1]:e;i.prototype[t]=function(){return this.send.apply(this,[e].concat(Array.prototype.slice.call(arguments)))}}),i.notifications.forEach(function(e){i.prototype[e]=function(){}}),i.events.forEach(function(e){i.prototype[e]=function(){}}),n?e.exports=i:t.Aria2=i}(this)}).call(t,n(133)(e))},56:function(e,t){e.exports={enableCookie:!0,userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/603.2.4 (KHTML, like Gecko) Version/10.1.1 Safari/603.2.4",catchIframe:!0,enableTypefiles:!1,enableXunleiLixian:!1,downloadPath:"",languageList:[{key:"en",value:"English"},{key:"zh-CN",value:"中文"}],language:"zh-CN",enableBaiduLixian:!0,disableBaiduLimit:!0,enableChart:!1,baidupanAutoRestart:!1,baidupanLimitSpeed:1e3,baiduPanCookie:"BDUSS=111111",defaultRpcIndex:0,refreshTime:1,uaList:[{name:"safari 10",content:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/603.2.4 (KHTML, like Gecko) Version/10.1.1 Safari/603.2.4"}],pathList:[{name:"电影",content:"/movie/电影"}],filetypes:"",rpcList:[{name:"dsm",push:!1,url:"http://token:a123@10.1.1.5:6800/jsonrpc"},{name:"mac",push:!0,url:"http://token:a123@127.0.0.1:6800/jsonrpc"}]}}},[160]);