webpackJsonp([4],{159:function(t,e,n){"use strict";function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=D.language||navigator.language;return x()(O,[n,t],e.notfailback?"":[t," "].join(""))}function a(){var t={};D.rpcList.forEach(function(e,n){var o=e.url.match(/^(http|ws)(s)?(?:\:\/\/)(token\:[^@]*)?@?([^\:\/]*)\:?(\d*)(\/[^\/]*)/),a={host:o[4],port:o[5]||6800,secure:!(!o||!o[2]),secret:o[3]?o[3].split(":")[1]:"",path:o[6]||"/jsonrpc"};if(P[e.url])t[e.url]=P[e.url],t[e.url].rpc.name=e.name,delete P[e.url];else{var r=new I.Aria2(a);t[e.url]={aria2:r,rpc:e,push:e.push}}e.push&&i(t[e.url],e.name)});for(var e in P){var n=P[e].aria2;n&&n.socket&&1===n.socket.readyState&&P[e].aria2.close()}P=t}function i(t,e){var n=t.aria2;return!(!t.aria2||!t.aria2.socket||1!==n.socket.readyState)||(n.open().then(function(){s(t,e),t.reconnect&&(delete t.reconnect,T.success([o("Successful links to"),e]))}).catch(function(n){x()(safari,"application.activeBrowserWindow.activeTab.url")&&(!t.reconnect&&T.error([o("Make sure the aria2 is running, every 10 seconds will automatically retry")],[e,o("Connection fail")]),t.reconnect=!0),M=M||setInterval(function(){var t=0;S()(P,function(e){e.push&&(t+=i(e)?0:1)}),t||clearInterval(M)},1e4)}),!1)}function r(){x()(safari,"extension.popovers[0].contentWindow.tlwin.refreshTaskList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshTaskList()}function s(t,e){var n=t.aria2,a=function(t){},i=function(t){r()},s=function(t,e){r(),c(n,t.gid).then(function(t){T.show(e?"error":"success",[t,o("Download"),o(e?"error":"success")])})};n.onDownloadStart=a,n.onDownloadPause=i,n.onDownloadStop=i,n.onDownloadComplete=s,n.onBtDownloadComplete=s,n.onDownloadError=function(t){s(t,!0)}}function c(t,e){return t.tellStatus(e,["bittorrent"]).then(function(n){return t.getFiles(e).then(function(t){return{files:t,bt:n}})}).then(function(t){var e=t.files[0].path,n=e.split("/").pop();return t.bt&&t.bt.info?bt.bittorrent.info.name:n}).catch(function(t){T.error([o("Failed to get task information")])})}function l(t){var e={},n=P[t[0].url],a=!!n&&n.aria2,i=D.enableCookie?"Cookie: "+t[3]:"";D.downloadPath&&(e.dir=D.downloadPath),a&&t[1]?a.addUri([t[1]],C({header:i,timeout:10,"content-disposition-default-utf8":!0,"user-agent":D.userAgent},e)).then(function(){T.success([o("Successfully added to the"),n.rpc.name,D.enableCookie?"":"(with cookie)"]),r()}).catch(function(t){T.error([o("Fail to Added to the"),n.rpc.name,D.enableCookie?"":"(without cookie)","("+t.message+")"]),console.log(t)}):T.error(["添加任务失败：没有url或者没有连接aria2"])}function u(t){"showOptions"===t.key&&f()}function f(){safari.application.activeBrowserWindow.openTab().url=safari.extension.baseURI+"options.html"}function d(){D=localStorage.getItem("safari2aria");try{D=JSON.parse(D||"{}")}catch(t){D={defaultRpcIndex:0}}j=D.filetypes?D.filetypes.split(" "):[];for(var t=0;t<j.length;t++)j[t]=j[t].toLowerCase();E=D.rpcList,p("updateConfig",C({},D,{sendAll:!0})),a(),x()(safari,"extension.popovers[0].contentWindow.tlwin.refreshServerList")&&safari.extension.popovers[0].contentWindow.tlwin.refreshServerList()}function p(t,e,n){e instanceof Function&&(n=e,e={}),n&&(e=Object.assign(e||{},{hasCb:!0}),R[t+"_cb"]=n),window.safari&&(e.sendAll?x()(safari,"application.browserWindows",[]).forEach(function(n){x()(n,"tabs",[]).forEach(function(n){n.page&&n.page.dispatchMessage(t,e)})}):safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(t,e))}function h(t){if(L=t.keyPressed||{},L.isShiftPressd&&L.isOptionPressd){for(var e=49;e<=57&&e-49<E.length;e++)if(L[e]){D.defaultRpcIndex=e-49,y({name:"updateSafari2Aria",message:D}),p("changeRpc",E[D.defaultRpcIndex].name);break}L[192]&&p("currentRpc",E[D.defaultRpcIndex].name),L[188]&&f(),L[76]&&safari&&safari.extension&&safari.extension.toolbarItems[0].showPopover()}}function m(t){var e=t.command.split("."),n={showOptions:function(){f()},DownloadWithXunleilixian:function(){safari.application.activeBrowserWindow.openTab().url=["http://lixian.vip.xunlei.com/?furl=",t.userInfo[0]].join("")},DownloadWithBaidulixian:function(){safari.application.activeBrowserWindow.openTab().url="https://pan.baidu.com/disk/home",W.baiduLixian={action:function(){p("baiduLixian",this.param),delete W.baiduLixian},param:{url:t.userInfo[0]}}},DownloadWithAria2:function(){var n=e[1];l([n&&E[n]?E[n]:E[0]].concat(t.userInfo))}};n[e[0]]&&n[e[0]]()}function v(t){var e=t.command&&t.command.match(/^DownloadWith/);if(e&&e.length>=0){var n=t.userInfo;n&&n.length&&n[0]||(t.target.disabled=!0)}}function g(t){n.i(A.a)(t.url,D,L)&&(t.preventDefault(),p("getCookie",function(e){l([E[D.defaultRpcIndex],t.url,t.target.url,e.cookie])}))}function w(t){E.forEach(function(e,n){t.contextMenu.appendContextMenuItem(["DownloadWithAria2",n].join("."),[o("Downloaded to"),e.name].join(""))}),D.enableXunleiLixian&&t.contextMenu.appendContextMenuItem("DownloadWithXunleilixian",[o("Import to thunder lixian")].join("")),D.enableBaiduLixian&&t.contextMenu.appendContextMenuItem("DownloadWithBaidulixian",[o("Import to baidu lixian")].join(""))}function y(t){R[t.name]&&R[t.name](t.message,t)}Object.defineProperty(e,"__esModule",{value:!0});var b=n(18),x=n.n(b),k=n(55),S=n.n(k),I=n(54),A=n(36),C=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},D={defaultRpcIndex:0},O={"zh-CN":{"Successful links to":"成功链接","Connection fail":"连接失败",Download:"下载",error:"失败","Import to thunder lixian":"导入至迅雷离线","Import to baidu lixian":"导入至百度离线","Downloaded to":"下载至",success:"成功","Successfully added to the":"成功添加至","Fail to Added to the":"无法添加至","Added to the":"添加至",failure:"失败","Failed to get task information":"获取任务信息失败","Make sure the aria2 is running, every 10 seconds will automatically retry":"请确认aria2已经运行,每隔10秒将会自动重试"}},L=void 0,j=[],E=[],P={},W={},M=void 0,R={updateSafari2Aria:function(t){localStorage.setItem("safari2aria",JSON.stringify(t)),d()},keyPress:function(t){h(t)},getConfig:function(){p("updateConfig",C({},D,{sendAll:!0}))},documentReady:function(){S()(W,function(t){t.action()})},downloadFromIframe:function(t,e){l([E[D.defaultRpcIndex],t.url,e.target.url,t.cookie])}},T={success:function(t,e){T.show("success",t,e)},error:function(t,e){T.show("error",t,e)},show:function(t,e,n){e instanceof Array&&(e=e.join("")),n instanceof Array&&(n=n.join("")),p("showMassage",{action:t||"success",text:e,title:n})}};window.s2a={changeServer:function(t){var e=void 0;S()(E,function(n,o){n.url===t&&(e=o)}),D.defaultRpcIndex=e,y({name:"updateSafari2Aria",message:D})},dispatchMessage:y,openOptions:f,getConfig:function(){return{config:D,aria2Connects:P}}},document.addEventListener("DOMContentLoaded",d),safari.application.addEventListener("message",y,!1),safari.extension.settings.addEventListener("change",u,!1),safari.application.addEventListener("command",m,!1),safari.application.addEventListener("validate",v,!1),safari.application.addEventListener("beforeNavigate",g,!1),safari.application.addEventListener("contextmenu",w,!1)},36:function(t,e,n){"use strict";function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&!n[82]&&e.enableTypefiles?!n.isCommandPressed:n.isCommandPressed){if(t.match(/magnet:[^\\"]+/))return!0;var o=t.substr(t.lastIndexOf(".")+1);o=o.toLowerCase();var a=e.filetypes?e.filetypes.split(" "):[];if(n.isShiftPressd)return!0;for(var i=0;i<a.length;i++)if(o===a[i].toLowerCase())return!0}}e.a=o},54:function(t,e,n){"use strict";(function(t){var e=n(127),o=n.n(e),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(e){var n=void 0!==t&&t.exports,i=function t(e){this.callbacks=Object.create(null),this.lastId=0;for(var n in t.options)this[n]="object"===(void 0===e?"undefined":a(e))&&n in e?e[n]:t.options[n]};i.prototype.http=function(t,e){var n=this,o={method:t.method,id:t.id};Array.isArray(t.params)&&t.params.length>0&&(o.params=t.params);var a="http"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path;fetch(a,{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(t){return t.json()}).then(function(t){n._onmessage(t)}).catch(e)},i.prototype.send=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof e[e.length-1]?e.pop():null;return this.exec(t,e,n)},i.prototype.exec=function(t,e,n){if("string"!=typeof t)throw new TypeError(t+" is not a string");0!==t.indexOf("system.")&&0!==t.indexOf("aria2.")&&(t="aria2."+t);var a={method:t,"json-rpc":"2.0",id:this.lastId++},i=this.secret?["token:"+this.secret]:[];Array.isArray(e)&&("system.multicall"===t?(Array.isArray(e[0])&&e[0].forEach(function(t){t.params||(t.params=[]),t.params=i.concat(t.params)}),i=e):i=i.concat(e)),i.length>0&&(a.params=i),this.onsend(a);var r=this;return this.socket&&1===this.socket.readyState?this.socket.send(JSON.stringify(a)):this.http(a,function(t){r.callbacks[a.id](t),delete r.callbacks[a.id]}),o()(function(t){r.callbacks[a.id]=t},n)},i.prototype._onmessage=function(t){if(this.onmessage(t),void 0!==t.id){var e=this.callbacks[t.id];e&&(t.error?e(t.error):e(null,t.result),delete this.callbacks[t.id])}else if(t.method){var n=t.method.split("aria2.")[1];0===n.indexOf("on")&&"function"==typeof this[n]&&i.notifications.indexOf(n)>-1&&this[n].apply(this,t.params)}},i.prototype.open=function(t){var e="ws"+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path,n=this.socket=new WebSocket(e),a=this,i=!1;return n.onmessage=function(t){a._onmessage(JSON.parse(t.data))},o()(function(t){n.onopen=function(){i||(t(),i=!0),a.onopen()},n.onclose=function(e){a.onclose(),1006==e.code&&(i||(t(e),i=!0))},n.onerror=function(e){i||(t(e),i=!0)}},t)},i.prototype.close=function(t){var e=this.socket;return o()(function(t){e?(e.addEventListener("close",function(){t()}),e.close()):t()},t)},i.methods=["addUri","addTorrent","addMetalink","remove","forceRemove","pause","pauseAll","forcePause","forcePauseAll","unpause","unpauseAll","tellStatus","getUris","getFiles","getPeers","getServers","tellActive","tellWaiting","tellStopped","changePosition","changeUri","getOption","changeOption","getGlobalOption","changeGlobalOption","getGlobalStat","purgeDownloadResult","removeDownloadResult","getVersion","getSessionInfo","shutdown","forceShutdown","saveSession","system.multicall","system.listMethods","system.listNotifications"],i.notifications=["onDownloadStart","onDownloadPause","onDownloadStop","onDownloadComplete","onDownloadError","onBtDownloadComplete"],i.events=["onopen","onclose","onsend","onmessage"],i.options={secure:!1,host:"localhost",port:6800,secret:"",path:"/jsonrpc"},i.methods.forEach(function(t){var e=t.indexOf(".")>-1?t.split(".")[1]:t;i.prototype[e]=function(){return this.send.apply(this,[t].concat(Array.prototype.slice.call(arguments)))}}),i.notifications.forEach(function(t){i.prototype[t]=function(){}}),i.events.forEach(function(t){i.prototype[t]=function(){}}),n?t.exports=i:e.Aria2=i}(this)}).call(e,n(132)(t))}},[159]);